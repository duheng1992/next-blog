---
title: React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼ˆå…«ï¼‰ - æ–°ç‰ˆæ–°å¢åŠŸèƒ½æ±‡æ€»
date: 2022/10/25
description: react router å®˜ç½‘è§£è¯»
tag: React router
author: å°è‚šè‚šè‚šè‚šè‚šå“¦
---
import Giscus from '/components/Giscus';
import Anchor from '/components/Anchor';

React Router v6ç‰ˆæœ¬ï¼Œå¬è¯´åˆæ›´æ–°äº†ä¸€ç‰ˆï¼Œå®˜ç½‘æ–‡æ¡£ä¹Ÿæ›´æ–°äº†ï¼ˆ6.4.2ï¼‰ã€‚è¿™é‡Œå°±æ±‡æ€»ç¿»è¯‘ä¸€ä¸‹æ–‡æ¡£æ›´æ–°çš„å†…å®¹ã€‚

äº†è§£å…¶ä»– React Router v6 çš„å®˜ç½‘æ–‡æ¡£ï¼Œå¯ä»¥çœ‹æˆ‘æœ¬ä¸“æ å¾€æœŸçš„æ–‡ç« ã€‚

## 1. å…³äº Routers

APIåˆ›å»ºrouterå¯¹è±¡ï¼š

### createBrowserRouter

ç±»å‹å®šä¹‰ï¼š

```js
function createBrowserRouter(
  routes: RouteObject[],
  opts?: {
    basename?: string;
    window?: Window;
  }
): RemixRouter;
```

è¿™ä¸ª API ç”¨äºä½¿ç”¨jsä»£ç åˆ›å»ºä¸€ä¸ª History routerã€‚ç¬¬äºŒä¸ªå±æ€§æ˜¯å¯é€‰å‚æ•°ï¼š

- basenameï¼šç›¸å¯¹è·¯ç”±æ ¹åœ°å€
- windowï¼šé‡æ–°æŒ‡å®šwindowå¯¹è±¡ï¼Œå¸¸ç”¨äºæµ‹è¯•ç¯å¢ƒæˆ–è€…éæµè§ˆå™¨ç¯å¢ƒ

ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š


```js
import {
  createBrowserRouter,
  RouterProvider,
} from "react-router-dom";

const router = createBrowserRouter([
  {
    path: "/",
    element: <Root />,
    loader: rootLoader,
    children: [
      {
        path: "team",
        element: <Team />,
        loader: teamLoader,
      },
    ],
  },
]);

ReactDOM.createRoot(document.getElementById("root")).render(
  <RouterProvider router={router} />
);
```

### createHashRouter

ä½¿ç”¨æ–¹å¼åŒ createBrowserRouterï¼Œåˆ›å»ºä¸€ä¸ªåŸºäºé”šç‚¹å¯¼èˆªçš„ routerã€‚

### createMemoryRouter

memory routeræ˜¯ä¸€ä¸ªèƒ½å¤Ÿè‡ªå·±ç®¡ç† history stack çš„ History routerã€‚å¸¸ç”¨äºå¼€å‘å·¥å…·ï¼ˆä¾‹å¦‚StoryBookï¼‰. æµ‹è¯•æˆ–éæµè§ˆå™¨ç¯å¢ƒã€‚

ç±»å‹å®šä¹‰ï¼š

```js
function createMemoryRouter(
  routes: RouteObject[],
  opts?: {
    basename?: string;
    initialEntries?: InitialEntry[];
    initialIndex?: number;
    window?: Window;
  }
): RemixRouter;
```

ä½¿ç”¨æ–¹å¼ï¼š

```js
import {
  RouterProvider,
  createMemoryRouter,
} from "react-router-dom";
import * as React from "react";
import {
  render,
  waitFor,
  screen,
} from "@testing-library/react";
import "@testing-library/jest-dom";
import CalendarEvent from "./routes/event";

test("event route", async () => {
  const FAKE_EVENT = { name: "test event" };
  const routes = [
    {
      path: "/events/:id",
      element: <CalendarEvent />,
      loader: () => FAKE_EVENT,
    },
  ];

  const router = createMemoryRouter(routes, {
    initialEntries: ["/", "/events/123"],
    initialIndex: 1,
  });

  render(<RouterProvider router={router} />);

  await waitFor(() => screen.getByRole("heading"));
  expect(screen.getByRole("heading")).toHaveTextContent(
    FAKE_EVENT.name
  );
});
```

å…¶ä¸­çš„å‚æ•°ï¼š

- initialEntriesï¼šåˆå§‹åŒ–çš„ history stack
- initialIndexï¼šåˆå§‹åŒ–æ˜¾ç¤ºçš„ history stack çš„ä¸‹æ ‡


### RouterProvider

ç»™ä¸Šè¿°åˆ›å»ºrouterçš„APIæä¾›ä¸€ä¸ªå®¹å™¨ã€‚å…¶æœ‰ç¬¬äºŒä¸ªå‚æ•° `fallbackElement={<SpinnerOfDoom />}`ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªåœ¨è·¯ç”±åŠ è½½è¿‡ç¨‹ä¸­ loadingçš„è‡ªå®šä¹‰ç»„ä»¶ã€‚

## 2. å…³äº Route ç»„ä»¶

### æ·»åŠ æ–°å±æ€§ loader

è·¯ç”±åœ¨æ¸²æŸ“ä¹‹å‰åŠ è½½çš„åŠ è½½å™¨ã€‚å½“è·¯ç”±è·³è½¬æ—¶ï¼Œloaderå‡½æ•°ä¼šå¼‚æ­¥çš„æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨ç›®æ ‡è·¯ç”±ç»„ä»¶ä¸­å¯ä»¥è·å–åˆ°ã€‚

ä½¿ç”¨æ–¹å¼ï¼š
```js
 {
    element: <Team />,
    path: ":teamId",
    loader: async ({ params }) => {
      return fetch(`/api/teams/${params.teamId}.json`);
    },
  },
```

å‚æ•° params æ˜¯è·¯ç”±å‚æ•°ã€‚å¯ä»¥è¿”å›ä»»ä½•ä½ æƒ³è¦çš„å†…å®¹ï¼Œæ¨èä½¿ç”¨ fetch æˆ–è€… Promiseã€‚

loader åŠ è½½çš„æ•°æ®å¯ä»¥åœ¨è·³è½¬ä¹‹åçš„ç•Œé¢ é€šè¿‡ useLoaderData è·å–ã€‚ä½¿ç”¨æ–¹å¼è§ä¸‹é¢ hooks çš„æ›´æ–°å†…å®¹ã€‚

### æ·»åŠ æ–°å±æ€§ action

æä¾›ä¸€ç§è·¯ç”±åˆ‡æ¢æ—¶è§¦å‘çš„æ–¹æ³•ã€‚è¯¥æ–¹å¼å…è®¸åœ¨è·¯ç”±è·³è½¬æ—¶æ¨é€ä¸€ä¸ª ajax è¯·æ±‚å‡ºå»ã€‚

ä½¿ç”¨æ–¹å¼ï¼š

```js
// å®šä¹‰
<Route
  path="/song/:songId/edit"
  element={<EditSong />}
  action={async ({ params, request }) => {
    let formData = await request.formData();
    return fakeUpdateSong(params.songId, formData);
  }}
  loader={({ params }) => {
    return fakeGetSong(params.songId);
  }}
/>

// forms
<Form method="post" action="/songs" />;
<fetcher.Form method="put" action="/songs/123/edit" />;

// imperative submissions
let submit = useSubmit();
submit(data, {
  method: "delete",
  action: "/songs/123",
});
fetcher.submit(data, {
  method: "patch",
  action: "/songs/123/edit",
});

```

è§¦å‘æ–¹å¼ä¸ºéGETç±»çš„è¯·æ±‚ï¼Œå¹¶æä¾›ä¸¤ä¸ªå‚æ•°ï¼š

- params è·¯ç”±åŠ¨æ€å‚æ•°
- request fetchè¯·æ±‚çš„å®ä¾‹

### errorElement

åªé€‚ç”¨äºAPIåŠ¨æ€åˆ›å»ºçš„routerã€‚ä½¿ç”¨æ–¹å¼ï¼š
```jsx
<Route
  path="/invoices/:id"
  // if an exception is thrown here
  loader={loadInvoice}
  // here
  action={updateInvoice}
  // or here
  element={<Invoice />}
  // this will render instead of `element`
  errorElement={<ErrorBoundary />}
/>;

function Invoice() {
  return <div>Happy {path}</div>;
}

function ErrorBoundary() {
  let error = useRouteError();
  console.error(error);
  // Uncaught ReferenceError: path is not defined
  return <div>Dang!</div>;
}
```
æä¾›ä¸€ç§è·¯ç”±è·³è½¬é”™è¯¯åçš„è¡¥æ•‘æ–¹æ¡ˆã€‚åœ¨action. loaderæˆ–è€…ç»„ä»¶æ¸²æŸ“è¿‡ç¨‹ä¸­æŠ›å‡ºé”™è¯¯åï¼Œå¯ä»¥åœ¨è¿™é‡Œæ•è·å¹¶ä»£æ›¿æ˜¾ç¤ºè‡ªå®šä¹‰çš„é”™è¯¯ç•Œé¢ã€‚

### shouldRevalidate

ä½œä¸ºä¸€ä¸ªä¼˜åŒ–é¡¹ï¼Œç”¨äºå¯¹loaderåšæ ¡éªŒã€‚ä»–æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è·¯ç”± loader è·å–æ•°æ®ä¹‹å‰è°ƒç”¨ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœè¿”å›å¸ƒå°”å€¼ï¼Œæœ¬æ¬¡ loader å‡½æ•°å°†ä¸ä¼šè°ƒç”¨ï¼Œç•Œé¢æ•°æ®ä¸ä¼šæ”¹å˜ã€‚

ä½¿ç”¨æ–¹å¼ï¼š
```jsx
<Route
  path="meals-plans"
  element={<MealPlans />}
  loader={loadMealPlans}
  shouldRevalidate={({ currentUrl }) => {
    // only revalidate if the submission originates from
    // the `/meal-plans/new` route.
    return currentUrl.pathname === "/meal-plans/new";
  }}
>
  <Route
    path="new"
    element={<NewMealPlanForm />}
    // `loadMealPlans` will be revalidated after
    // this action...
    action={createMealPlan}
  />
  <Route
    path=":planId/meal"
    element={<Meal />}
    // ...but not this one because origin the URL
    // is not "/meal-plans/new"
    action={updateMeal}
  />
</Route>
```

## 3. å…³äºè·¯ç”±ç»„ä»¶

### Await

æ˜¯ä¸€ç§ç±»ä¼¼äº React è·¯ç”±æ‡’åŠ è½½ï¼ˆlazyï¼‰çš„å·¥å…·ã€‚ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```jsx
import { Await, useLoaderData } from "react-router-dom";

function Book() {
  const { book, reviews } = useLoaderData();
  return (
    <div>
      <h1>{book.title}</h1>
      <p>{book.description}</p>
      <React.Suspense fallback={<ReviewsSkeleton />}>
        <Await
          resolve={reviews}
          errorElement={
            <div>Could not load reviews ğŸ˜¬</div>
          }
          children={(resolvedReviews) => (
            <Reviews items={resolvedReviews} />
          )}
        />
      </React.Suspense>
    </div>
  );
}
```

### Form

v6ç‰ˆè·¯ç”±ï¼Œå¯¹äº plain HTMLÂ form è¿›è¡Œäº†ä¸€ä¸ªåŒ…è£…ã€‚ç›®å‰ä»…ä»…åœ¨ä½¿ç”¨ API åˆ›å»ºè·¯ç”±å®ä¾‹çš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚

```jsx
import { Form } from "react-router-dom";

function NewEvent() {
  return (
    <Form method="post" action="/events">
      <input type="text" name="title" />
      <input type="text" name="description" />
      <button type="submit">Create</button>
    </Form>
  );
}
```

å±æ€§å‚æ•°ä»‹ç»ï¼š

- actionï¼šform submit çš„ urlã€‚å’ŒåŸç”Ÿformå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œä»–çš„é»˜è®¤urlæ˜¯æœ€è¿‘åŒ¹é…åˆ°çš„ç›¸å¯¹è·¯ç”±
- methodï¼šè¡¨å•æäº¤çš„æ–¹æ³•
- replaceï¼šæ”¹å˜ history stack çš„åˆ‡æ¢æ–¹å¼
- relativeï¼šè®¾ç½®ç›¸å¯¹è·¯ç”±çš„æ ¹è·¯ç”±
- reloadDocumentï¼šè·³è¿‡ React Router å¹¶ä½¿ç”¨æµè§ˆå™¨çš„å†…ç½®è¡Œä¸ºæäº¤è¡¨å•

ç»¼åˆä½¿ç”¨æ¡ˆä¾‹ï¼š

> **æ€»ç»“**ï¼šaction å¯ä»¥æ¥å— element ç»„ä»¶ä¸­ä¼ å…¥çš„è¯·æ±‚å®ä¾‹ï¼Œåœ¨actionä¸­è¿›è¡Œä½¿ç”¨ã€‚è€Œç´§æ¥ç€ï¼Œelement ç»„ä»¶ä¸­ï¼Œåˆå¯ä»¥é€šè¿‡ useLoaderData ä½¿ç”¨ loader é‡ŒåŠ è½½è¿›æ¥çš„æ•°æ®ã€‚

```jsx
<Route
  path="/projects/:id"
  element={<Project />}
  loader={async ({ params }) => {
    return fakeLoadProject(params.id)
  }}
  action={async ({ request, params }) => {
    switch (request.method) {
      case "put": {
        let formData = await request.formData();
        let name = formData.get("projectName");
        return fakeUpdateProject(name);
      }
      case "delete": {
        return fakeDeleteProject(params.id);
      }
      default {
        throw new Response("", { status: 405 })
      }
    }
  }}
/>;

function Project() {
  let project = useLoaderData();

  return (
    <>
      <Form method="put">
        <input
          type="text"
          name="projectName"
          defaultValue={project.name}
        />
        <button type="submit">Update Project</button>
      </Form>

      <Form method="delete">
        <button type="submit">Delete Project</button>
      </Form>
    </>
  );
}
```

### ScrollRestoration

ç”¨äºåœ¨æµè§ˆå™¨ locationå˜åŒ–åï¼Œä¿æŒæ»šåŠ¨æ¡çš„ä½ç½®ã€‚ä»…ä»…åœ¨ API åˆ›å»ºè·¯ç”±å¯¹è±¡æ—¶æœ‰æ•ˆã€‚

æ¨èåœ¨æ ¹è·¯ç”±ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨æ–¹å¼ï¼š

```jsx
import { ScrollRestoration } from "react-router-dom";

function RootRouteComponent() {
  return (
    <div>
      {/* ... */}
      <ScrollRestoration
        getKey={(location, matches) => {
          // default behavior
          return location.key;
        }}
      />
    </div>
  );
}
```

å‚æ•°ï¼š

- getKeyï¼šReact Router ç¼“å­˜æ»šåŠ¨ä½ç½®çš„key
- preventScrollResetï¼šå½“åˆ›å»ºä¸€ä¸ªæ–°çš„ scroll keyæ—¶ï¼Œé¡µé¢æ»šåŠ¨ä½ç½®ä¼šè¢«é‡ç½®åœ¨é¡¶éƒ¨ã€‚ä½ å¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸º true æ¥é˜»æ­¢é¡µé¢è¢«é‡ç½®å›é¡¶éƒ¨

<hr />


## 4. Hooks

### useActionData

æä¾›ä¸Šä¸€ä¸ªè·³è½¬æ—¶ action çš„è¿”å›å€¼ã€‚å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼Œåˆ™æ˜¯ undefinedã€‚

ä½¿ç”¨æ–¹å¼ï¼ˆæœ€å¸¸ç”¨çš„å°±æ˜¯è¡¨å•éªŒè¯ï¼‰ï¼š

```jsx
import {
  useActionData,
  Form,
  redirect,
} from "react-router-dom";

export default function SignUp() {
  // 2. è·å– action è¿”å›å€¼
  const errors = useActionData();

  return (
    <Form method="post">
      <p>
        <input type="text" name="email" />
        {errors?.email && <span>{errors.email}</span>}
      </p>

      <p>
        <input type="text" name="password" />
        {errors?.password && <span>{errors.password}</span>}
      </p>

      <p>
        <button type="submit">Sign up</button>
      </p>
    </Form>
  );
}

export async function action({ request }) {
  const formData = await request.formData();
  const email = formData.get("email");
  const password = formData.get("password");
  const errors = {};

  // validate the fields
  if (typeof email !== "string" || !email.includes("@")) {
    errors.email =
      "That doesn't look like an email address";
  }

  if (typeof password !== "string" || password.length < 6) {
    errors.password = "Password must be > 6 characters";
  }

  // return data if we have errors
  if (Object.keys(errors).length) {
    // 1. action ä¸­ return ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ redirect
    return errors;
  }

  // otherwise create the user and redirect
  await createUser(email, password);
  return redirect("/dashboard");
}
```

### useAsyncError

è¿”å› Await ç»„ä»¶ çš„rejectçš„å€¼ï¼š

```jsx
import { useAsyncError, Await } from "react-router-dom";

function ErrorElement() {
  const error = useAsyncError();
  return (
    <p>Uh Oh, something went wrong! {error.message}</p>
  );
}

<Await
  resolve={promiseThatRejects}
  errorElement={<ErrorElement />}
/>;
```

### useAsyncValue

è¿”å› Await ç»„ä»¶çš„ resolve å€¼ï¼š

```jsx
function ProductVariants() {
  const variants = useAsyncValue();
  return <div>{/* ... */}</div>;
}

// Await creates the context for the value
<Await resolve={somePromiseForProductVariants}>
  <ProductVariants />
</Await>;
```

### useFetcher

> useFetcherä»…ä»…åœ¨ä½¿ç”¨ API åˆ›å»ºrouterå®ä¾‹ä¸­æœ‰æ•ˆã€‚


å½“ä½ éœ€è¦ï¼š

- è·å–ä¸ UI è·¯ç”±æ— å…³çš„æ•°æ®ï¼ˆå¼¹å‡ºæ¡†. åŠ¨æ€è¡¨å•ç­‰ï¼‰
- æ— éœ€å¯¼èˆªå³å¯å°†æ•°æ®æäº¤çš„æ“ä½œï¼ˆå…±äº«ç»„ä»¶ï¼Œå¦‚å®æ—¶é€šè®¯æ³¨å†Œï¼‰
- å¤„ç†åˆ—è¡¨ä¸­çš„å¤šä¸ªå¹¶å‘æäº¤ï¼ˆå…¸å‹çš„â€œå¾…åŠäº‹é¡¹åº”ç”¨ç¨‹åºâ€åˆ—è¡¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å•å‡»å¤šä¸ªæŒ‰é’®ï¼Œå¹¶ä¸”æ‰€æœ‰æŒ‰é’®éƒ½åº”åŒæ—¶å¤„äºå¾…å¤„ç†çŠ¶æ€ï¼‰
- æ— é™æ»šåŠ¨å®¹å™¨

ç­‰ç­‰ï¼ŒuseFetcher å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼š

```jsx
import { useFetcher } from "react-router-dom";

function SomeComponent() {
  const fetcher = useFetcher();

  // æäº¤åŠ¨ä½œ
  React.useEffect(() => {
    fetcher.submit(data, options);
    fetcher.load(href);
  }, [fetcher]);

  // å¯ä»¥ç›´æ¥è·å–æ•°æ®
  fetcher.state;
  fetcher.formData;
  fetcher.formMethod;
  fetcher.formAction;
  fetcher.data;

  // ä¸ä¼šè§¦å‘è·¯ç”±å¯¼èˆªçš„è¡¨å•
  return <fetcher.Form />;
}
```


fetchers æœ‰å¾ˆå¤šå†…ç½®çš„è¡Œä¸ºï¼š

- ä¸­æ–­æ—¶ï¼Œè‡ªåŠ¨å¤„ç†fetchå–æ¶ˆ
- ä½¿ç”¨ POST. PUT. PATCH. DELETE æäº¤æ—¶ï¼Œé¦–å…ˆè°ƒç”¨è¯¥æ“ä½œï¼š
    - æ“ä½œå®Œæˆåï¼Œé¡µé¢ä¸Šçš„æ•°æ®å°†é‡æ–°éªŒè¯ä»¥æ•è·å¯èƒ½å‘ç”Ÿçš„ä»»ä½•çªå˜ï¼Œè‡ªåŠ¨ä½¿æ‚¨çš„ UI ä¸æ‚¨çš„æœåŠ¡å™¨çŠ¶æ€ä¿æŒåŒæ­¥
- å½“å¤šä¸ª fetcher åŒæ—¶è¿è¡Œæ—¶ï¼Œå®ƒä¼šï¼š
    - åœ¨ä»–ä»¬æ¯æ¬¡ç™»é™†æ—¶æäº¤æœ€æ–°çš„å¯ç”¨æ•°æ®
    - ç¡®ä¿æ²¡æœ‰é™ˆæ—§çš„è´Ÿè½½è¦†ç›–æ›´æ–°çš„æ•°æ®ï¼Œæ— è®ºå“åº”è¿”å›çš„é¡ºåºå¦‚ä½•
- é€šè¿‡å‘ˆç°æœ€è¿‘çš„ errorElement æ¥å¤„ç†æœªæ•è·çš„é”™è¯¯ï¼ˆå°±åƒæ¥è‡ª \<Link> æˆ– \<Form> çš„æ­£å¸¸å¯¼èˆªï¼‰
- å¦‚æœæ‚¨çš„æ“ä½œ/åŠ è½½ç¨‹åºè¢«è°ƒç”¨è¿”å›é‡å®šå‘ï¼Œå°†é‡å®šå‘åº”ç”¨ç¨‹åºï¼ˆå°±åƒæ¥è‡ª \<Link> æˆ– \<Form> çš„æ­£å¸¸å¯¼èˆªä¸€æ ·ï¼‰



å…¶ä¸­å„ä¸ªå±æ€§çš„è®²è§£ï¼š

- `fetcher.state`: æäº¤çš„çŠ¶æ€ï¼Œæšä¸¾å¦‚ä¸‹ï¼š
    -   **idle**Â - nothing is being fetched.
    -   **submitting**Â - A route action is being called due to a fetcher submission using POST, PUT, PATCH, or DELETE
    -   **loading**Â - The fetcher is calling a loader (from aÂ `fetcher.load`) or is being revalidated after a separate submission orÂ `useRevalidator`Â call
- `fetcher.Form`: ä¸ä¼šå¯¼èˆªçš„è¡¨å•
- `fetcher.load`: é€šè¿‡ router loader åŠ è½½æ•°æ®ï¼š 
```js
if (fetcher.state === "idle" && !fetcher.data) {
    fetcher.load("/some/route");
}
```
- `fetcher.submit`: æ¨¡æ‹Ÿfetcher.Form çš„æäº¤åŠ¨ä½œã€‚æ¯”å¦‚ä¸€ä¸ªç”¨æˆ·ç™»å‡ºçš„æ“ä½œï¼š

```jsx
import { useFetcher } from "react-router-dom";
import { useFakeUserIsIdle } from "./fake/hooks";

export function useIdleLogout() {
  const fetcher = useFetcher();
  const userIsIdle = useFakeUserIsIdle();

  useEffect(() => {
    if (userIsIdle) {
      fetcher.submit(
        { idle: true },
        { method: "post", action: "/logout" }
      );
    }
  }, [userIsIdle]);
}
```

- `fetcher.data`: loader æˆ–è€… action è¿”å›çš„æ•°æ®ä¼šå­˜å‚¨åœ¨è¿™é‡Œ
- `fetcher.formData`: å½“ä½¿ç”¨`<fetcher.Form>`Â orÂ `fetcher.submit()`æ—¶ï¼ŒformData å¯ä»¥ç”¨æ¥è·å–æäº¤æ•°æ®ï¼š

```jsx
function TaskCheckbox({ task }) {
  let fetcher = useFetcher();

  // é€šè¿‡ get æ–¹æ³•å¯ä»¥è·å–åˆ°formDataå†…çš„å€¼ï¼Œåå‘å½±å“æäº¤è¡¨å•çš„æ¸²æŸ“
  let status =
    fetcher.formData?.get("status") || task.status;

  let isComplete = status === "complete";

  return (
    <fetcher.Form method="post">
      <button
        type="submit"
        name="status"
        value={isComplete ? "incomplete" : "complete"}
      >
        {isComplete ? "Mark Incomplete" : "Mark Complete"}
      </button>
    </fetcher.Form>
  );
}
```

- `fetcher.formAction`: è·å–å½“å‰æäº¤çš„ action çš„ url
- `fetcher.formMethod`: è·å–å½“å‰æäº¤çš„ action çš„ method


### useFetchers

è¿”å›æ‰€æœ‰fetcherçš„æ•°ç»„ï¼Œä½†ä¸æºå¸¦Â `load`,Â `submit`, Â `Form`Â ä¿¡æ¯ã€‚

### useFormAction

ç±»å‹å®šä¹‰ï¼š
```tsx
declare function useFormAction(
  action?: string,
  { relative }: { relative?: RelativeRoutingType } = {}
): string;
```

å¯¹action çš„urlåŒ…è£…äº†ä¸€å±‚ï¼Œä¼šè‡ªåŠ¨è§£æç›¸å¯¹è·¯å¾„ã€‚è¯¥ä½¿ç”¨ä¸å¤ªå¸¸è§ã€‚

ä½¿ç”¨æ–¹å¼ï¼š
```jsx
import { useFormAction } from "react-router-dom";

function DeleteButton() {
  return (
    <button
      formAction={useFormAction("destroy")}
      formMethod="post"
    >
      Delete
    </button>
  );
}
```

### useLoaderData

ç”¨æˆ·è·å–route loaderçš„è¿”å›å€¼ã€‚

ä½¿ç”¨æ–¹å¼ï¼š
```jsx
import {
  createBrowserRouter,
  RouterProvider,
  useLoaderData,
} from "react-router-dom";

function loader() {
  return fetchFakeAlbums();
}

export function Albums() {
  const albums = useLoaderData();
  // ...
}

const router = createBrowserRouter([
  {
    path: "/",
    loader: loader,
    element: <Albums />,
  },
]);

ReactDOM.createRoot(el).render(
  <RouterProvider router={router} />
);
```

useLoaderData ä¸ä¼šé‡å¤æå–æ•°æ®ã€‚å®ƒåªæ˜¯è¯»å– React Router å†…éƒ¨ç®¡ç†çš„ fetch çš„ç»“æœï¼Œå½“å®ƒç”±äºè·¯ç”±ä¹‹å¤–çš„åŸå› é‡æ–°æ¸²æŸ“æ—¶ï¼Œæ‚¨æ— éœ€æ‹…å¿ƒå®ƒä¼šé‡æ–°è·å–ã€‚è¿™ä¹Ÿæ„å‘³ç€è¿”å›æ•°æ®å’Œæ¸²æŸ“ä¹‹é—´ï¼Œdataæ˜¯ç¨³å®šçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°å°†å…¶ä¼ é€’ç»™ React é’©å­ï¼ˆå¦‚ useEffectï¼‰ä¸­çš„ä¾èµ–æ•°ç»„ã€‚åªæœ‰åœ¨æ“ä½œæˆ–æŸäº›å¯¼èˆªåå†æ¬¡è°ƒç”¨åŠ è½½ç¨‹åºæ—¶ï¼Œå®ƒæ‰ä¼šæ›´æ”¹ã€‚


### useMatches

è¿”å›å½“å‰åŒ¹é…çš„è·¯ç”±é¡¹ã€‚ä½¿ç”¨æ¡ˆä¾‹ï¼šé¢åŒ…å±‘å¯¼èˆªï¼š

```jsx
// è·¯ç”±è¡¨
<Route element={<Root />}>
  <Route
    path="messages"
    element={<Messages />}
    loader={loadMessages}
    handle={{
      // you can put whatever you want on a route handle
      // here we use "crumb" and return some elements,
      // this is what we'll render in the breadcrumbs
      // for this route
      crumb: () => <Link to="/message">Messages</Link>,
    }}
  >
    <Route
      path="conversation/:id"
      element={<Thread />}
      loader={loadThread}
      handle={{
        // `crumb` is your own abstraction, we decided
        // to make this one a function so we can pass
        // the data from the loader to it so that our
        // breadcrumb is made up of dynamic content
        crumb: (data) => <span>{data.threadName}</span>,
      }}
    />
  </Route>
</Route>

// å¯¼èˆªç»„ä»¶
function Breadcrumbs() {
  let matches = useMatches();
  let crumbs = matches
    // first get rid of any matches that don't have handle and crumb
    .filter((match) => Boolean(match.handle?.crumb))
    // now map them into an array of elements, passing the loader
    // data to each one
    .map((match) => match.handle.crumb(match.data));

  return (
    <ol>
      {crumbs.map((crumb, index) => (
        <li key={index}>{crumb}</li>
      ))}
    </ol>
  );
}
```

### useNavigation

è·å–è·¯ç”±åŠ è½½è¿‡ç¨‹ä¸­çš„å„ç§å¯¼èˆªå‚æ•°ï¼Œä½¿ç”¨åœºæ™¯ï¼š

- å…¨å±€åŠ è½½ loading
- éœ€è¦å…¨å±€ç¦ç”¨ form
- æäº¤æ—¶è¡¨å•å¤„ç†ä¸­çš„åŠ¨ç”»
- ...

ä½¿ç”¨æ–¹å¼ï¼š

```jsx
import { useNavigation } from "react-router-dom";

function SomeComponent() {
  const navigation = useNavigation();
  navigation.state; // idle â†’ submitting â†’ loading â†’ idle
  navigation.location;
  navigation.formData;
  navigation.formAction;
  navigation.formMethod;
}
```

### useRevalidator

ç”¨äºé‡æ–°éªŒè¯æ•°æ®çš„åœºæ™¯ï¼Œä½¿ç”¨æ–¹å¼ï¼š
```jsx
import { useRevalidator } from "react-router-dom";

function WindowFocusRevalidator() {
  let revalidator = useRevalidator();

  useFakeWindowFocus(() => {
    revalidator.revalidate();
  });

  return (
    <div hidden={revalidator.state === "idle"}>
      Revalidating...
    </div>
  );
}
```

### useRouteError

åœ¨ errorElementå±æ€§ç»„ä»¶å†…éƒ¨ä½¿ç”¨ï¼Œè¿”å›ä»»ä½•è·¯ç”±ä¸­å‡ºç°çš„é”™è¯¯ã€‚ä½¿ç”¨æ–¹å¼ï¼š

```jsx
function ErrorBoundary() {
  const error = useRouteError();
  console.error(error);
  return <div>{error.message}</div>;
}

<Route
  errorElement={<ErrorBoundary />}
  loader={() => {
    // unexpected errors in loaders/actions
    something.that.breaks();
  }}
  action={() => {
    // stuff you throw on purpose in loaders/actions
    throw new Response("Bad Request", { status: 400 });
  }}
  element={
    // and errors thrown while rendering
    <div>{breaks.while.rendering}</div>
  }
/>;
```

### useRouteLoaderData

æ”¶é›†è·¯ç”±æ ‘ä¸Šæ‰€æœ‰çš„loaderæ•°æ®ã€‚åœ¨éœ€è¦å…¨å±€æŠŠæ§å¤šåµŒå¥—è·¯ç”±å‚æ•°æ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚

ä½¿ç”¨æ–¹å¼ï¼š

```jsx
createBrowserRouter([
  {
    path: "/",
    loader: () => fetchUser(),
    element: <Root />,
    id: "root",
    children: [
      {
        path: "jobs/:jobId",
        loader: loadJob,
        element: <JobListing />,
      },
    ],
  },
]);

...
const user = useRouteLoaderData("root");
```

é€šè¿‡è·¯ç”±çš„idæ¥è¯†åˆ«è·¯ç”±æ ‘çš„èµ·ç‚¹ã€‚

### useSubmit

åŠ¨æ€æäº¤è¡¨å•ã€‚ä½¿ç”¨æ–¹å¼ï¼š
```jsx
import { useSubmit, Form } from "react-router-dom";

function SearchField() {
  let submit = useSubmit();
  return (
    <Form
      onChange={(event) => {
        submit(event.currentTarget, { method: "post", action: "/check" });
      }}
    >
      <input type="text" name="search" />
      <button type="submit">Search</button>
    </Form>
  );
}
```

## 5. æ–°å¢å°å·¥å…·

### json

jsonè½¬æ¢å·¥å…·ï¼š

```jsx
import { json } from "react-router-dom";

const loader = async () => {
  const data = getSomeData();
  return json(data);
};
```

### redirect

é‡å®šå‘ã€‚åœ¨ loader å’Œ action ä¸­æ¨èä½¿ç”¨ï¼Œè€Œä¸æ˜¯ useNavigateï¼Œä»–ç­‰ä»·äºå¦‚ä¸‹æ“ä½œï¼š

```js
new Response("", {
  status: 302,
  headers: {
    Location: someUrl,
  },
});
```
ä½¿ç”¨æ¡ˆä¾‹ï¼š
```jsx
import { redirect } from "react-router-dom";

const loader = async () => {
  const user = await getUser();
  if (!user) {
    return redirect("/login");
  }
};
```

<Giscus />
<Anchor name="React Router v6 å®˜æ–¹æ–‡æ¡£ç¿»è¯‘ï¼ˆå…«ï¼‰ - æ–°ç‰ˆæ–°å¢åŠŸèƒ½æ±‡æ€»" />
