# æ‰‹æŠŠæ‰‹æ­å»ºåŸºäºReactçš„å‰ç«¯UIåº“ ï¼ˆä¸ƒï¼‰-- å¼¹å‡ºå±‚ç»„ä»¶
---

## 1. å‰è¨€

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æˆ‘ä»¬ç»§ç»­æˆ‘ä»¬çš„ React ç»„ä»¶åº“ç³»åˆ—ã€‚æœ¬ç¯‡ä»‹ç»å¼¹å‡ºå±‚ PopOverä»¥åŠ tooltip çš„å®ç°ã€‚æœ¬æ–‡çš„ä»£ç å±•ç¤ºçš„æ˜¯ä¸»è¦çš„æ ¸å¿ƒä»£ç ï¼Œå…¨éƒ¨ä»£ç è§ä»“åº“ï¼š[Giteeä»“åº“](https://link.juejin.cn/?target=https%3A%2F%2Fgitee.com%2Fdh1992%2Fdux-ui-react%2F "https://gitee.com/dh1992/dux-ui-react/")ï¼Œç»„ä»¶æ ·å¼è§[ä¸»é¡µ](https://dh1992.gitee.io/dux-ui-react/)ã€‚


## 2. å®šä¹‰å…¥å‚

é¦–å…ˆï¼Œè¿˜æ˜¯å…ˆç¡®å®šä¸€ä¸‹ä¸€ä¸ªå¼¹å‡ºå±‚éƒ½éœ€è¦ä»€ä¹ˆå‚æ•°æ¥æ§åˆ¶å‘¢ã€‚ç›¸ä¿¡å¤§å®¶ä¹Ÿéƒ½ç”¨è¿‡Tooltipä¹‹ç±»çš„ç»„ä»¶ï¼Œè‚¯å®šæœ‰æ§åˆ¶æ˜¾ç¤ºéšè—çš„å±æ€§ï¼Œè¿˜æœ‰å±•å¼€æ–¹å‘ç­‰ï¼Œæˆ‘è¿™é‡Œæ€»ç»“äº†ä¸€ä¸‹åŸºç¡€çš„å±æ€§ï¼š


| å±æ€§ | è¯´æ˜ |
| --- | --- |
| visible | å—æ§ï¼Œæ§åˆ¶å¼¹å‡ºå±‚å±•ç¤º |
| trigger | è§¦å‘æ–¹å¼ |
| placement | å±•å¼€æ–¹å‘ |
| onVisibleChange | æ˜¾ç¤ºäº‹ä»¶ |
| popup | å¼¹å‡ºå±‚çš„å…ƒç´  |
| zIndex | å±‚çº§ |
| popupClassName | å¼¹å‡ºå±‚ç±»å |


## 3. rc-trigger

[rc-trigger](https://www.npmjs.com/package/rc-trigger)æ˜¯ä¸€å¥—æµè¡Œçš„å¼€æºåº“ï¼Œé›†æˆäº†å„ç§è§¦å‘æ–¹å¼åˆ¤æ–­ã€å¼¹å‡ºå±‚æ¸²æŸ“ç­‰åŠŸèƒ½ã€‚æœ¬ç»„ä»¶åº“å°±ä½¿ç”¨è¯¥ç¬¬ä¸‰æ–¹åº“ã€‚

å…ˆå¼•å…¥ä¸€ä¸‹ï¼š

```js
import RcTrigger from 'rc-trigger';
```
ç„¶åå£°æ˜ä¸€ä¸ªrcTriggerçš„ç»„ä»¶ï¼š

```jsx
class RcTriggerWrap extends Component {
  static propTypes = {
    className: PropTypes.string,
    popupClassName: PropTypes.string,
    trueClassName: PropTypes.string,
  };
  render() {
    const { className, popupClassName, trueClassName, ...rest } = this.props as any;
    return (
      <RcTrigger
        className={trueClassName}
        popupClassName={classnames(className, popupClassName)}
        {...rest}
      />
    );
  }
}
```

æ¥ä¸‹æ¥ï¼Œç”¨styledæ ·å¼åŒ…è£¹ä¸€ä¸‹ï¼Œä¾¿äºæˆ‘ä»¬è‡ªå®šä¹‰æ ·å¼ï¼š

```jsx
import styled from '@emotion/styled';

export const PopoverWrap = styled(RcTriggerWrap)`
    /* æ”¾ç½®css */
`;
```
è¿™ä¸ª`PopoverWrap`ä¾¿æ˜¯æˆ‘ä»¬ä¹‹åè¦ç”¨çš„å¼¹å‡ºå±‚ç»„ä»¶çš„å¤–å£³äº†ã€‚

å¼¹å‡ºå±‚çš„ç»„ä»¶ï¼Œå…¶å®åªéœ€è¦å¯¹å¤–æš´éœ² `action` ã€`placement` å’Œ `popup`å±æ€§å°±è¡Œäº†ï¼Œæ‰€è°“åœ¨å¯¼å‡ºæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å†å°è£…ä¸€ä¸‹ã€‚

åœ¨ç»„ä»¶åº“çš„index.tsxæ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š


```tsx
...
return <PopoverWrap
            action={trigger}
            popupPlacement={placement}
            popupTransitionName={
              transitionName || animation ? animationPrefixCls + '-' + animation : null
            }
            popupVisible={popup == null ? false : this.state.visible}
            popup={popup}
            onPopupVisibleChange={this.onVisibleChange}
            popupClassName={className}
            getPopupContainer={getPopupContainer}
      >
            {children}
      </PopoverWrap>
```
- `action`å¯¹åº”çš„æ˜¯rc-triggerçš„actionå±æ€§ï¼Œtriggeré€šè¿‡propsæ¥å—ã€‚æŒ‡çš„æ˜¯è§¦å‘å¼¹å‡ºçš„æ“ä½œï¼Œå¯é€‰é¡¹æœ‰ 'hover','click','focus','contextMenu'ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œé»˜è®¤ä¸ºï¼š`['hover']`

- `popupPlacement`å¯¹åº”çš„æ˜¯rc-triggerçš„popupPlacementå±æ€§ï¼Œé€šè¿‡propsæ¥å—ã€‚æ˜¯ä¸€ä¸ªæšä¸¾é¡¹ï¼Œæšä¸¾å®šä¹‰å¦‚ä¸‹ï¼š

```ts
placement?:
    | 'topLeft'
    | 'top'
    | 'topRight'
    | 'bottomLeft'
    | 'bottom'
    | 'bottomRight'
    | 'leftTop'
    | 'left'
    | 'leftBottom'
    | 'rightTop'
    | 'right'
    | 'rightBottom';
```

- `popupTransitionName`å¯¹åº”rc-triggerçš„popupTransitionNameå±æ€§ï¼Œå®šä¹‰å¼¹å‡ºçš„åŠ¨ç”»ï¼Œæ˜¯å¯é€‰é¡¹ã€‚å¯é€šè¿‡propsæ¥å—animationå±æ€§æ¥å®šä¹‰ã€‚ç›®å‰ï¼Œrc-triggeråªæ”¯æŒä¸Šä¸‹æ–¹å‘çš„åŠ¨ç”»ï¼Œå…¶å†…éƒ¨ä½¿ç”¨äº†rc-animationï¼Œå¯é€‰é¡¹å¦‚ä¸‹ï¼š
`"fade" | "zoom" | "bounce" | "slide-up"`

- `popupVisible`å¯¹åº”rc-triggerçš„popupVisibleå±æ€§ï¼Œåœ¨ç”¨æˆ·ä¼ äº†popupåï¼Œé€šè¿‡props.visibleå±æ€§æ¥æ§åˆ¶ï¼Œè‹¥ç”¨æˆ·æ²¡æœ‰ä¼ popupï¼Œå¼ºè¡Œç½®ä¸ºfalse

- `popup`å¯¹åº”rc-triggerçš„popupå±æ€§ï¼Œæ˜¯æœ€æ ¸å¿ƒçš„å‚æ•°ï¼Œå¯ä¼ ä¸€ä¸ªElementå…ƒç´ ï¼Œç”¨äºå¼¹å‡ºå±‚çš„å±•ç¤ºã€‚
- `onPopupVisibleChange`å±æ€§åŒä¸Šï¼Œåœ¨popupå¼¹å‡ºæ—¶è§¦å‘ã€‚
- `popupClassName`å¯¹åº”rc-tableçš„popupClassNameï¼Œç»™å¼¹å‡ºå±‚åŠ ä¸€ä¸ªç±»åã€‚
- `getPopupContainer`å¯¹åº”rc-tableçš„getPopupContainerï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªå¼¹å‡ºå±‚å®¹å™¨ï¼Œéå¿…é€‰é¡¹ã€‚
- æœ€åä¸èƒ½å°‘äº†å‚æ•° `children`, é€šè¿‡hoveræˆ–è€…clickè¿™ä¸ªchildrenæ‰èƒ½è§¦å‘å¼¹å‡ºå±‚çš„å˜åŒ–ã€‚rc-triggerç»„ä»¶å¯ä»¥éšæ€§çš„ä¼ ä¸€ä¸ªåŒåçš„childrenï¼Œæ–‡æ¡£é‡Œè™½ç„¶æ²¡æœ‰å†™æ˜ï¼Œä½†æ˜¯reactç»„ä»¶é»˜è®¤éƒ½å¯ä»¥è¿™æ ·ä¼ é€’ã€‚


## 4. å®šä¹‰æ ·å¼

å¯¹äºå¼¹å‡ºå±‚ç»„ä»¶çš„å¤–å£³PopoverWrapï¼Œè¿˜è®°å¾—ä¸Šè¾¹é¢„ç•™çš„æ ·å¼çš„ç©ºç™½äº†å—ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ†æƒ…å†µè®¨è®ºã€‚

å…ˆæŠŠå¤–å£³è®¾ç½®ä¸ºç»å¯¹å®šä½ï¼Œè¿™æ˜¯ä¸ºäº†é…åˆrc-triggerçš„topå’Œbottomæ ·å¼ï¼Œå¦å¤–ï¼Œæƒ³è¦å¼¹å‡ºå±‚è·Ÿéšç‚¹å‡»åŒºåŸŸï¼Œä¹Ÿå¿…é¡»ç»å¯¹å®šä½ï¼Œçˆ¶å…ƒç´ ä½¿ç”¨ç›¸å¯¹å®šä½ã€‚

```tsx
const _prefixCls = 'dux-ui'; // é€šè¿‡å¯¼å…¥å…¨å±€å˜é‡è·å¾—

export const prefixCls = _prefixCls + '-popover';
export const animationPrefixCls = prefixCls + '-animation';

export const PopoverWrap = styled(RcTriggerWrap)`
  &.${prefixCls} {
    // å¼¹å‡ºå±‚ç»å¯¹å®šä½
    position: absolute;
    z-index: 1030;
    display: block;

    &-hidden {
      display: none;
    }
  }
  ...
`;
```

åœ¨æ§åˆ¶å°é‡Œå¯ä»¥çœ‹åˆ°ï¼š

![WeChat37acb5ff66ca4ccd10b4cf17b7162a84.png](/images/2022-6-22/2022-6-22-1.png)

rc-triggerä¼šåœ¨ä¼ å…¥çš„popupClassNameåæ‹¼æ¥ä¸€ä¸ªå¸¦æœ‰æ–¹å‘å‚æ•°çš„ç±»åï¼Œç”±æ­¤ï¼Œæˆ‘ä»¬æ¥å®šä¹‰å„è‡ªçš„æ ·å¼ï¼Œä»¥å·¦ä¸‹å’Œå·¦ä¸Šä¸ºä¾‹ï¼š


```scss
&-enter-active.${prefixCls}-placement-bottomLeft,
    &-appear-active.${prefixCls}-placement-bottomLeft {
    animation-name: ${slideUpIn};
    animation-play-state: running;
}
&-enter-active.${prefixCls}-placement-topLeft,
    &-appear-active.${prefixCls}-placement-topLeft {
    animation-name: ${slideDownIn};
    animation-play-state: running;
}
```

åˆ†åˆ«é…ç½®ä½¿ç”¨ä¸åŒçš„åŠ¨ç”»ï¼Œå¦‚æœä¸æƒ³è‡ªå®šä¹‰åŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®ã€‚


å¦‚æœpropsä¸­å£°æ˜äº†åŠ¨ç”»ç±»å‹ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªè¿™æ ·çš„ç±»åï¼š

![WeChat2b4c3d7733fd94dae215a0b13c47490f.png](/images/2022-6-22/2022-6-22-2.png)


ä»¥fadeä¸ºä¾‹ï¼Œå¯ä»¥è¿™æ ·å£°æ˜cssï¼š

```css
const animationDuration = '0.1s';

...
&-fade {
  &-enter,
  &-appear,
  &-leave {
    animation-duration: ${animationDuration};
    animation-fill-mode: both;
  }
  &-enter,
  &-appear {
    animation-name: ${fadeIn};
  }
  &-leave {
    animation-name: ${fadeOut};
  }
}
```

è‡³äºåŠ¨ç”»çš„å…·ä½“å†™æ³•ï¼Œæœ‰å¾ˆå¤šç§ï¼Œè¿™é‡Œä»¥æ·¡å…¥æ·¡å‡ºä¸ºä¾‹ï¼Œå®ç°ä¸€ç§ä½œä¸ºå‚è€ƒï¼š

```css
export const fadeIn = keyframes`
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
`;
export const fadeOut = keyframes`
    from {
        opacity: 1;
    }

    to {
        opacity: 0;
    }
`;
```

## 5. ä¸€ä¸ªğŸŒ° 

æœ‰äº†è¿™äº›åŸºæœ¬çš„é…ç½®ï¼Œä¸€ä¸ªå¼¹å‡ºå±‚ç»„ä»¶å°±èƒ½è·‘èµ·æ¥äº†ã€‚

æµ‹è¯•ï¼š

```tsx
const Popup = () => (
  <div style={{ height: 30, border: '1px solid #ddd', background: '#fff' }}>This is a popup</div>
);

<Popover trigger={['hover']} popup={<Popup />}>
    <Content>{'hover'}</Content>
</Popover>
```

é¢„è§ˆæ•ˆæœï¼š


![WeChatee739043574f992511ff4658245bc54f.png](/images/2022-6-22/2022-6-22-3.png)

æˆåŠŸï¼


## 6. è¿›é˜¶ï¼šåšä¸€ä¸ªTooltip

Tooltipçš„åº•å±‚ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªpopoverï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ã€‚

ç›´æ¥çœ‹returnçš„ç»“æœï¼š

```tsx
<Popover
      placement={placement}
      popupClassName={...}
      popup={popup}
 />
```
Tooltipä¸åŒäºé€šç”¨å¼¹å‡ºå±‚çš„åœ°æ–¹åœ¨äºpopupçš„å†…å®¹ï¼Œä»–ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼æ¼«ç”»å¯¹è¯æ¡†çš„å°ç®­å¤´ã€‚é‚£æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸‹popupï¼š


```tsx
export const arrowWrapCls = popoverPrefixCls + '-span' + '-arrow-wrap';
export const arrowCls = popoverPrefixCls + '-span' + '-arrow-inner';

const popup = useMemo(() => {
    return (
      <TooltipWrap>
        {arrow && (
          <Arrow className={arrowWrapCls}>
            <ArrowInner className={arrowCls} />
          </Arrow>
        )}
        <ContentWrap customStyle={customStyle}>
          {popup}
        </ContentWrap>
      </TooltipWrap>
    );
  }, [popup, arrow, customStyle, theme]);
```

å¯ä»¥çœ‹åˆ°å…¶æ¥å—äº†å‡ ä¸ªæ–°çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥åˆ†æã€‚

- `arrow`: ä¸€ä¸ªboolå€¼ï¼Œæ§åˆ¶æ˜¯å¦æ˜¾ç¤ºç®­å¤´ã€‚é»˜è®¤æ˜¯æ²¡æœ‰çš„ï¼š

![image.png](/images/2022-6-22/2022-6-22-4.png)

æˆ‘ä»¬æ¥å®šä¹‰ç®­å¤´çš„æ ·å¼ï¼Œä»¥ top çš„æ–¹å‘ä¸ºä¾‹ï¼š


```css
const arrowMixin = css`
  display: inline-block;
  position: absolute;
  width: 0;
  height: 0;
  border-width: 0;
  border-color: transparent;
  border-style: solid;
`;

export const Arrow = styled('span')`
  ${arrowMixin};
`;
export const ArrowInner = styled('span')`
  ${arrowMixin};
`;

.${arrowWrapCls}, .${arrowCls} {
    margin-left: -${arrowWidth};
    border-width: ${arrowWidth} ${arrowWidth} 0 ${arrowWidth};
    border-bottom-color: transparent;
    border-left-color: transparent;
    border-right-color: transparent;
}
.${arrowWrapCls} {
    bottom: -${arrowWidth};
}
.${arrowCls} {
    bottom: ${borderWidth};
}
```
å¯ä»¥çœ‹åˆ°ï¼Œç”¨ä¸€ä¸ªç»å¯¹å®šä½çš„spanåŒ…è£¹ï¼Œè®¾ç½®å®½é«˜æ˜¯0ï¼Œç„¶åè®¾ç½®å…¶ä¸Šã€å³ã€å·¦è¾¹æ¡†å®½åº¦åå†è®¾ç½®å‚ç›´æ–¹å‘çš„åæ–¹å‘ï¼Œå³ä¸‹ã€å·¦ã€å³è¾¹æ¡†ä¸ºé€æ˜è‰²ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªç®­å¤´å‡ºæ¥ï¼Œæ•ˆæœå›¾å¦‚ä¸‹ï¼š


![image.png](/images/2022-6-22/2022-6-22-5.png)

åŒç†ï¼Œå¯è®¾ç½®å…¶ä»–æ–¹å‘çš„ç®­å¤´æ ·å¼~~

- `popup`: æ˜¯å¼¹å‡ºå±‚å…ƒç´ ã€‚
- `TooltipWrap`å’Œ`ContentWrap`æ˜¯styledåŒ…è£¹ç»„ä»¶ï¼Œæœ¬è´¨æ˜¯ä¸ªdivï¼Œå¯ä»¥è‡ªå®šä¹‰æ ·å¼ã€‚

<hr />

è‡³æ­¤ï¼Œå¼¹å‡ºå±‚ç»„ä»¶ä¹Ÿè®²å®Œè¾£~~
